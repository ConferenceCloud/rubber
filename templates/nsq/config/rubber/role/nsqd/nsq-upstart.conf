<%
  @path = "/etc/init/nsqd.conf"
  @backup = false
%>
description "nsqd"

start on runlevel [2345]
stop on runlevel [016]

script
  ulimit -n 65536
  exec /usr/bin/nsqd -config="<%= rubber_env.nsq_conf_file %>" --lookupd-tcp-address="<%= "#{rubber_instances.for_role('nsqlookupd').first.internal_ip}:#{rubber_env.nsq_lookupd_tcp_port}" %>" -broadcast-address="<%= "#{rubber_instance.internal_ip}:#{rubber_env.nsq_tcp_port}" %>" &> <%= rubber_env.nsq_log_file %>
end script

post-start script
  status nsqd | head -n1 | awk '{print $NF}' > <%= rubber_env.nsq_pid_file %>
end script

post-stop script
  rm -f <%= rubber_env.nsq_pid_file %>
end script
